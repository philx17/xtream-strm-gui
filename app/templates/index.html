<!doctype html>
<html lang="de">
<head>
	<link rel="stylesheet" href="static/style.css">
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Xtream → STRM (Allowlist)</title>
</head>
<body>
  <h2>Xtream → STRM</h2>
  <div class="row">
    <div class="card">
      <p id="statusTop" class="small muted"></p>
      <h3>Server</h3>
      <label>Base URL (z.B. http://host:port)
        <input id="base_url" type="text" placeholder="http://..." />
      </label>
      <label>Username
        <input id="username" type="text" />
      </label>
      <label>Password
        <input id="password" type="password" />
      </label>
      <label>Output (ts empfohlen)
        <input id="output" type="text" placeholder="ts oder m3u8" />
      </label>
      <label>Output-Verzeichnis (im Container: /output)
        <input id="out_dir" type="text" />
      </label>

      <div class="hr"></div>

      <label><input id="sync_delete" type="checkbox"/> Entfernte Einträge lokal löschen (.strm)</label>
      <label><input id="prune_sidecars" type="checkbox"/> Beim Löschen auch Sidecars entfernen (jpg/nfo etc.)</label>

      <!-- NEW: LiveTV Export mode -->
      <div class="hr"></div>
      <h4 style="margin: 0 0 4px;">LiveTV Export</h4>
      <div class="radio-row">
        <label for="livetv_export_strm">
          <input id="livetv_export_strm" name="livetv_export_mode" type="radio" value="strm" checked>
          <span>STRM + poster/backdrop (Ordner je Sender)</span>
        </label>
        <label for="livetv_export_m3u">
          <input id="livetv_export_m3u" name="livetv_export_mode" type="radio" value="m3u">
          <span>M3U Playlist (livetv.m3u) + tvg-logo (Picons)</span>
        </label>
      </div>
      <div class="hint">
        Hinweis: M3U nutzt <code>group-title</code> aus der Kategorie und setzt <code>tvg-logo</code> anhand des besten Picon-Matches.
        (In Schritt 2/3 verdrahten wir das im JS + Backend.)
      </div>

      <div class="hr"></div>

      <label><input id="sched_enabled" type="checkbox"/> Daily Sync aktivieren</label>
      <label>Uhrzeit (HH:MM)
        <input id="sched_time" type="text" placeholder="03:30" />
      </label>

      <div class="actions">
        <button id="btn_save" class="primary">Speichern</button>
        <button id="btn_test">Verbindung testen</button>
        <button id="btn_refresh">Playlist laden</button>
        <button id="btn_run">Run now</button>
      </div>
      <p id="status" class="small muted"></p>

      <div class="hr"></div>
      <h4>Status</h4>
      <div id="conn_box" class="grid2"></div>

      <p class="small muted">
        Headless-Run ohne GUI: <code>docker exec xtream-strm-gui python -m app.runner</code>
      </p>
    </div>

    <div class="card" style="flex:2">
      <h3>Auswahl (was geladen werden soll)</h3>
      <div class="tabs">
        <div class="tab active" data-tab="livetv">LiveTV</div>
        <div class="tab" data-tab="movies">Filme</div>
        <div class="tab" data-tab="series">Serien</div>
      </div>

      <div id="panel_livetv" class="panel">
        <div class="split">
          <div class="left">
            <input id="search_livetv_cat" class="search" placeholder="Kategorie suchen...">
            <div id="livetv_cats" class="list"></div>
          </div>
          <div class="right">
            <input id="search_livetv_items" class="search" placeholder="Sender suchen...">
            <div class="actions">
              <button id="livetv_select_cat">Kategorie auswählen</button>
              <button id="livetv_clear_cat">Kategorie abwählen</button>
            </div>
            <div id="livetv_items" class="list"></div>
          </div>
        </div>
      </div>

      <div id="panel_movies" class="panel" style="display:none">
        <div class="split">
          <div class="left">
            <input id="search_movies_cat" class="search" placeholder="Kategorie suchen...">
            <div id="movies_cats" class="list"></div>
          </div>
          <div class="right">
            <input id="search_movies_items" class="search" placeholder="Filme suchen...">
            <div class="actions">
              <button id="movies_select_cat">Kategorie auswählen</button>
              <button id="movies_clear_cat">Kategorie abwählen</button>
            </div>
            <div id="movies_items" class="list"></div>
          </div>
        </div>
      </div>

      <div id="panel_series" class="panel" style="display:none">
        <div class="split">
          <div class="left">
            <input id="search_series_show" class="search" placeholder="Show suchen...">
            <div id="series_shows" class="list"></div>
          </div>
          <div class="right">
            <input id="search_series_eps" class="search" placeholder="Episoden suchen (optional)...">
            <div id="series_eps" class="list"></div>
            <p class="small muted">Tipp: Wenn du eine Show auswählst, werden automatisch alle Folgen dieser Show synchronisiert. Einzelne Episoden-Auswahl ist optional (wenn du keine Show auswählst).</p>
          </div>
        </div>
      </div>

    </div>
  </div>

<script src="/static/app.js"></script>
</body>
</html>